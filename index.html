<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Photo Filter Converter</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f9f9f9;
    margin: 0;
    padding: 15px;
  }
  .container {
    max-width: 600px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 10px #ccc;
  }
  h1 {
    color: #007BFF;
    text-align: center;
  }
  label {
    margin-top: 15px;
    display: block;
    font-weight: bold;
  }
  input[type="file"] {
    width: 100%;
    padding: 8px;
    margin-top: 6px;
    box-sizing: border-box;
    border: 1px solid #ccc;
    border-radius: 6px;
  }
  #preview {
    margin-top: 15px;
    max-width: 100%;
    border-radius: 8px;
    display: none;
    box-shadow: 0 0 6px #aaa;
  }
  button {
    margin-top: 20px;
    width: 100%;
    padding: 14px;
    background-color: #007BFF;
    border: none;
    color: white;
    font-size: 18px;
    border-radius: 8px;
    cursor: pointer;
  }
  button.download-btn {
    background-color: #28a745;
    margin-top: 10px;
  }
  select {
    margin-top: 15px;
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  .result {
    margin-top: 20px;
    background: #eef4ff;
    padding: 15px;
    border-radius: 8px;
    font-size: 1rem;
    color: #333;
    text-align: center;
  }
</style>
</head>
<body>

<div class="container">
  <h1>Photo Filter Converter</h1>

  <label for="imageUpload">Upload an image file</label>
  <input type="file" id="imageUpload" accept="image/*" />

  <img id="preview" alt="Image preview" />

  <label for="filterSelect">Choose Filter</label>
  <select id="filterSelect">
    <option value="" disabled selected>-- Select Filter --</option>
    <option value="vintage">Vintage</option>
    <option value="grayscale">Grayscale</option>
    <option value="sunlight">Sunlight</option>
    <option value="moonlight">Moonlight</option>
    <option value="cartoon">Cartoon</option>
    <option value="fog">Fog</option>
    <option value="ghost">Ghost</option>
    <option value="negative">Negative</option>
    <option value="reverse">Reverse Colours</option>
  </select>

  <button id="applyBtn" disabled>Apply Filter</button>
  <button id="downloadBtn" class="download-btn" disabled>Download</button>

  <canvas id="canvas" style="display:none;"></canvas>

  <div id="result" class="result"></div>
</div>

<script>
  const imageUpload = document.getElementById('imageUpload');
  const preview = document.getElementById('preview');
  const filterSelect = document.getElementById('filterSelect');
  const applyBtn = document.getElementById('applyBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const canvas = document.getElementById('canvas');
  const result = document.getElementById('result');

  let loadedImage = new Image();

  function clamp(val) {
    return Math.min(255, Math.max(0, val));
  }

  function checkEnableButtons() {
    const enabled = preview.src && preview.style.display !== 'none' && filterSelect.value;
    applyBtn.disabled = !enabled;
    downloadBtn.disabled = true;
  }

  imageUpload.addEventListener('change', () => {
    const file = imageUpload.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      preview.src = e.target.result;
      preview.style.display = 'block';
      loadedImage.src = e.target.result;
      result.textContent = '';
      checkEnableButtons();
    };
    reader.readAsDataURL(file);
    filterSelect.value = "";
  });

  filterSelect.addEventListener('change', () => {
    checkEnableButtons();
  });

  function drawFog(ctx, width, height) {
    const fogCount = Math.floor(width * height / 15000);
    ctx.fillStyle = 'rgba(255,255,255,0.08)';
    for (let i = 0; i < fogCount; i++) {
      const x = Math.random() * width;
      const y = Math.random() * height;
      const radius = (Math.random() * 50) + 20;
      ctx.beginPath();
      ctx.ellipse(x, y, radius, radius * 0.6, 0, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function cartoonFilter(imageData) {
    const width = imageData.width;
    const height = imageData.height;
    const data = imageData.data;
    const newData = new Uint8ClampedArray(data.length);

    function grayscale(i) {
      return 0.3 * data[i] + 0.59 * data[i+1] + 0.11 * data[i+2];
    }

    for (let y=0; y < height; y++) {
      for (let x=0; x < width; x++) {
        const i = (y * width + x) * 4;
        const current = grayscale(i);
        const right = x < width - 1 ? grayscale(i + 4) : current;
        const down = y < height - 1 ? grayscale(i + width * 4) : current;

        const edge = Math.abs(current - right) + Math.abs(current - down);
        if (edge > 30) {
          newData[i] = 0;
          newData[i+1] = 0;
          newData[i+2] = 0;
          newData[i+3] = data[i+3];
        } else {
          newData[i] = Math.floor(data[i] / 64) * 64 + 32;
          newData[i+1] = Math.floor(data[i+1] / 64) * 64 + 32;
          newData[i+2] = Math.floor(data[i+2] / 64) * 64 + 32;
          newData[i+3] = data[i+3];
        }
      }
    }
    for (let i=0; i<data.length; i++) {
      data[i] = newData[i];
    }
  }

  applyBtn.addEventListener('click', () => {
    if (!loadedImage.src) return;

    const ctx = canvas.getContext('2d');
    canvas.width = loadedImage.naturalWidth;
    canvas.height = loadedImage.naturalHeight;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(loadedImage, 0, 0);

    let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    let data = imageData.data;
    const filter = filterSelect.value;

    switch(filter) {
      case 'vintage':
        for (let i = 0; i < data.length; i += 4) {
          const r = data[i], g = data[i+1], b = data[i+2];
          data[i] = clamp((r * 0.393) + (g * 0.769) + (b * 0.189));
          data[i+1] = clamp((r * 0.349) + (g * 0.686) + (b * 0.168));
          data[i+2] = clamp((r * 0.272) + (g * 0.534) + (b * 0.131));
        }
        break;

      case 'grayscale':
        for (let i = 0; i < data.length; i += 4) {
          const avg = (data[i] + data[i+1] + data[i+2]) / 3;
          data[i] = data[i+1] = data[i+2] = avg;
        }
        break;

      case 'sunlight':
        for (let i=0; i<data.length; i+=4) {
          data[i] = clamp(data[i] * 1.15 + 20);
          data[i+1] = clamp(data[i+1] * 1.05 + 10);
          data[i+2] = clamp(data[i+2] * 0.9);
        }
        break;

      case 'moonlight':
        for (let i = 0; i < data.length; i += 4) {
          const r = data[i];
          const g = data[i+1];
          const b = data[i+2];
          let dr = r * 0.2;
          let dg = g * 0.3;
          let db = b * 0.6;
          db = clamp(db + 40);
          const luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;
          dr = dr * 0.6 + luminance * 0.4;
          dg = dg * 0.6 + luminance * 0.4;
          db = db * 0.6 + luminance * 0.4;
          data[i] = dr;
          data[i+1] = dg;
          data[i+2] = db;
        }
        break;

      case 'cartoon':
        cartoonFilter(imageData);
        break;

      case 'fog':
        // Fog overlay after drawing image data
        ctx.putImageData(imageData, 0, 0);
        drawFog(ctx, canvas.width, canvas.height);
        // Skip putImageData after to preserve fog overlay
        preview.src = canvas.toDataURL();
        result.textContent = `Applied filter: ${filterSelect.options[filterSelect.selectedIndex].text}`;
        downloadBtn.disabled = false;
        return;

      case 'ghost':
        ctx.globalAlpha = 0.6;
        ctx.drawImage(loadedImage, 10, 10);
        ctx.globalAlpha = 1;
        imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        break;

      case 'negative':
        for (let i = 0; i < data.length; i += 4) {
          data[i] = 255 - data[i];
          data[i+1] = 255 - data[i+1];
          data[i+2] = 255 - data[i+2];
        }
        break;

      case 'reverse':
        for (let i = 0; i < data.length; i += 4) {
          let r = data[i], b = data[i+2];
          data[i] = b;
          data[i+2] = r;
        }
        break;

      default:
        break;
    }

    ctx.putImageData(imageData, 0, 0);

    preview.src = canvas.toDataURL();
    result.textContent = `Applied filter: ${filterSelect.options[filterSelect.selectedIndex].text}`;
    downloadBtn.disabled = false;
  });

  downloadBtn.addEventListener('click', () => {
    if (!canvas.toDataURL) return;
    const link = document.createElement('a');
    link.download = 'filtered-image.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  });
</script>

</body>
  </html>
  
